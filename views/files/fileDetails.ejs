<!-- views/files/fileDetails.ejs -->
<!DOCTYPE html>
<html lang="en">
  <%- include('../partials/head', { title: 'File Details', pageCss: 'file-details' }) %>

  <body class="bg-gray-50 min-h-screen flex flex-col">
    <%- include('../partials/header', { user: user }) %>

    <main class="flex-grow container mx-auto px-4 py-12">
      <div class="bg-white shadow rounded-lg p-8 max-w-2xl mx-auto">
        <h2 class="text-3xl font-bold text-gray-800 mb-8 flex items-center gap-2">
          <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M4 4h16v16H4z" />
          </svg>
          <%= file.filename %>
        </h2>

        <% if (error) { %>
          <%- include('../partials/errors', { message: error }) %>
        <% } %>

        <% if (success) { %>
          <%- include('../partials/success', { message: success }) %>
        <% } %>

        <ul class="space-y-4 mb-8">
          <li class="flex justify-between text-gray-700">
            <span class="font-semibold">Size:</span>
            <span><%= (file.size / 1024).toFixed(1) %> KB</span>
          </li>
          <li class="flex justify-between text-gray-700">
            <span class="font-semibold">Type:</span>
            <span><%= file.mimeType %></span>
          </li>
          <li class="flex justify-between text-gray-700">
            <span class="font-semibold">Uploaded At:</span>
            <span><%= file.uploadedAt.toLocaleString() %></span>
          </li>
          <% if (file.folderId === null) { %>
            <li class="flex justify-between text-gray-700">
              <span class="font-semibold">Folder:</span>
              <span class="italic text-gray-500">Not assigned!</span>
            </li>
          <% } else { %>
            <li class="flex justify-between text-gray-700">
              <span class="font-semibold">Folder ID:</span>
              <span><%= file.folderId %></span>
            </li>
          <% } %>
        </ul>

        <div class="flex flex-col sm:flex-row gap-4">
          <a href="/file/<%= file.id %>/download" class="inline-flex items-center justify-center px-5 py-3 bg-green-600 text-white text-sm font-semibold rounded hover:bg-green-700 transition">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path d="M4 16v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2" />
              <path d="M7 10l5 5 5-5" />
              <path d="M12 15V3" />
            </svg>
            Download
          </a>

          <% if (file.folderId === null) { %>
            <button
              type="button"
              onclick="toggleAssignForm()"
              class="inline-flex items-center justify-center px-5 py-3 bg-blue-600 text-white text-sm font-semibold rounded hover:bg-blue-700 transition"
            >
              <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M12 4v16m8-8H4" />
              </svg>
              Assign to Folder
            </button>
          <% } %>
        </div>

        <% if (file.folderId === null) { %>
          <form
            action="/file/<%= file.id %>/assign-folder"
            method="post"
            class="mt-8 hidden"
            id="assignForm"
          >
            <label for="folderId" class="block text-sm font-medium text-gray-700 mb-2">
              Select Folder:
            </label>
            <select
              name="folderId"
              id="folderId"
              class="block w-full border-gray-300 rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition mb-4"
              required
            >
              <option value="">-- Choose a Folder --</option>
              <% folders.forEach(folder => { %>
                <option value="<%= folder.id %>"><%= folder.name %></option>
              <% }) %>
            </select>

            <button type="submit" class="w-full px-4 py-2 bg-blue-600 text-white text-sm font-semibold rounded hover:bg-blue-700 transition">
              Assign
            </button>
          </form>
        <% } %>
      </div>
    </main>

    <%- include('../partials/footer') %>

    <script>
      function toggleAssignForm() {
        const form = document.getElementById("assignForm");
        form.classList.toggle("hidden");
      }
    </script>
  </body>
</html>
